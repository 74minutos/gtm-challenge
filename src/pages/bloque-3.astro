---
import BloqueLayout from '../layouts/BloqueLayout.astro';
import QAToolSelector from '../components/games/QAToolSelector.tsx';
import FunnelDetective from '../components/games/FunnelDetective.tsx';
import StagingBugQuiz from '../components/games/StagingBugQuiz.tsx';
---

<BloqueLayout 
  title="Bloque 3: El ojo que todo lo ve" 
  bloqueId="bloque-3"
>
  <!-- Welcome -->
  <section class="py-12 text-center">
    <div class="text-6xl mb-4">ğŸ‘ï¸</div>
    <h1 class="text-4xl font-bold mb-4">El ojo que todo lo ve</h1>
    <span class="inline-block px-4 py-2 bg-emerald-500/20 text-emerald-300 rounded-full text-sm mb-8">
      â±ï¸ Bloque 3 Â· ~25 min
    </span>
    
    <div class="bg-slate-800/50 rounded-xl p-6 max-w-3xl mx-auto text-left mb-8">
      <p class="text-xl mb-4"><strong>En este bloque vas a aprender a ver lo invisible.</strong></p>
      <p class="text-slate-300 mb-4">Los eventos ya no son lÃ­neas de cÃ³digo: son pruebas de que tu mediciÃ³n funciona.</p>
      <p class="text-slate-300">DescubrirÃ¡s cÃ³mo validar lo que implementas, detectar errores antes de que cuesten dinero y convertirte en el "ojo que todo lo ve" dentro del equipo.</p>
    </div>

    <div class="bg-amber-500/10 border-l-4 border-amber-500 p-6 rounded-r-xl max-w-3xl mx-auto">
      <p class="text-lg"><strong>Has aprendido a hablar el idioma de GTM...</strong></p>
      <p class="text-lg">Pero hablar no basta.</p>
      <p class="text-lg text-amber-300">Si no puedes ver y comprobar lo que estÃ¡s diciendo... los datos no existen.</p>
    </div>
  </section>

  <!-- Por quÃ© validar es clave -->
  <section class="py-12 border-t border-slate-700">
    <h2 class="text-3xl font-bold text-center mb-8">ğŸ“š Por quÃ© validar es clave</h2>
    
    <div class="bg-slate-800/50 rounded-xl p-6 max-w-3xl mx-auto mb-8">
      <p class="text-lg mb-4">La verificaciÃ³n no es un paso tÃ©cnico mÃ¡s.</p>
      <p class="text-xl font-bold text-emerald-400">Es la frontera entre un dato Ãºtil y un espejismo costoso.</p>
    </div>

    <div class="bg-emerald-500/10 p-6 rounded-xl max-w-2xl mx-auto mb-8">
      <h3 class="font-bold mb-4">ğŸ“Œ Razones para QA:</h3>
      <ul class="space-y-2 text-slate-300">
        <li>âœ… Los errores en tracking no siempre dan error visible</li>
        <li>âœ… Una etiqueta rota puede inflar o romper mÃ©tricas silenciosamente</li>
        <li>âœ… La validaciÃ³n permite prevenir problemas antes de escalar campaÃ±as</li>
        <li>âœ… QA = autonomÃ­a para no depender de "alguien de tech"</li>
      </ul>
    </div>

    <h3 class="text-xl font-bold text-center mb-6">ğŸš¨ Casos reales: Lo que cuesta un tracking roto</h3>
    
    <div class="grid md:grid-cols-3 gap-6 max-w-5xl mx-auto">
      <div class="bg-red-500/10 p-6 rounded-xl border-l-4 border-red-500">
        <h4 class="font-bold text-red-400 mb-3">ğŸ’¥ Tag GA4 rompe silenciosamente</h4>
        <p class="text-sm text-slate-300 mb-2"><strong>QuÃ© pasÃ³:</strong> Dev cambiÃ³ un DOM selector. La etiqueta deja de capturar clics de compra.</p>
        <p class="text-xs text-slate-400"><strong>Sin QA:</strong> â‚¬50k en ad spend inÃºtil.</p>
        <p class="text-xs text-green-400"><strong>Con QA:</strong> Se detecta en 2 horas. PÃ©rdida = â‚¬0.</p>
      </div>
      <div class="bg-blue-500/10 p-6 rounded-xl border-l-4 border-blue-500">
        <h4 class="font-bold text-blue-400 mb-3">ğŸ’¥ Eventos duplicados</h4>
        <p class="text-sm text-slate-300 mb-2"><strong>QuÃ© pasÃ³:</strong> Dos devs implementaron el mismo evento sin saber.</p>
        <p class="text-xs text-slate-400"><strong>Sin QA:</strong> ConversiÃ³n 2x inflada. Marketing invierte en lo que NO funciona.</p>
        <p class="text-xs text-green-400"><strong>Con QA:</strong> Una reuniÃ³n de 15 min lo arregla.</p>
      </div>
      <div class="bg-green-500/10 p-6 rounded-xl border-l-4 border-green-500">
        <h4 class="font-bold text-green-400 mb-3">âœ… ValidaciÃ³n previene desastres</h4>
        <p class="text-sm text-slate-300 mb-2"><strong>QuÃ© pasÃ³:</strong> QA detecta que Meta Pixel no trackea compras en iOS 14+.</p>
        <p class="text-xs text-slate-400"><strong>AcciÃ³n:</strong> Arreglan antes de escalar budget. Evitan quemar â‚¬100k.</p>
      </div>
    </div>

    <div class="bg-amber-500/10 border-l-4 border-amber-500 p-6 rounded-r-xl max-w-3xl mx-auto mt-8 text-center">
      <p class="text-lg font-bold">"Un marketer que no valida es como un piloto que no mira el radar."</p>
    </div>
  </section>

  <!-- Herramientas esenciales de QA -->
  <section class="py-12 border-t border-slate-700">
    <h2 class="text-3xl font-bold text-center mb-8">ğŸ› ï¸ Herramientas esenciales de QA</h2>
    
    <div class="space-y-6 max-w-3xl mx-auto">
      <div class="bg-slate-800/50 p-6 rounded-xl">
        <div class="flex items-start gap-4">
          <span class="w-4 h-4 bg-yellow-500 rounded-full mt-2 shrink-0"></span>
          <div>
            <h4 class="font-bold text-lg">Preview Mode GTM</h4>
            <p class="text-slate-300">Ver si el evento entra, quÃ© triggers se activan y quÃ© variables se leen.</p>
          </div>
        </div>
      </div>
      
      <div class="bg-slate-800/50 p-6 rounded-xl">
        <div class="flex items-start gap-4">
          <span class="w-4 h-4 bg-blue-500 rounded-full mt-2 shrink-0"></span>
          <div>
            <h4 class="font-bold text-lg">Google Analytics 4 DebugView</h4>
            <p class="text-slate-300">Confirmar si GA4 recibe el evento y con quÃ© payload.</p>
            <a href="https://support.google.com/analytics/answer/7201382" target="_blank" class="text-blue-400 text-sm hover:underline">â†’ DocumentaciÃ³n oficial</a>
          </div>
        </div>
      </div>
      
      <div class="bg-slate-800/50 p-6 rounded-xl">
        <div class="flex items-start gap-4">
          <span class="w-4 h-4 bg-green-500 rounded-full mt-2 shrink-0"></span>
          <div>
            <h4 class="font-bold text-lg">Omnibug / Tag Assistant</h4>
            <p class="text-slate-300">Analizar requests salientes, comprobar parÃ¡metros.</p>
            <div class="flex gap-4 mt-2">
              <a href="https://chromewebstore.google.com/detail/omnibug/bknpehncffejahipecakbfkomebjmokl" target="_blank" class="text-blue-400 text-sm hover:underline">â†’ Omnibug</a>
              <a href="https://tagassistant.google.com/" target="_blank" class="text-blue-400 text-sm hover:underline">â†’ Tag Assistant</a>
            </div>
          </div>
        </div>
      </div>
      
      <div class="bg-slate-800/50 p-6 rounded-xl">
        <div class="flex items-start gap-4">
          <span class="w-4 h-4 bg-orange-500 rounded-full mt-2 shrink-0"></span>
          <div>
            <h4 class="font-bold text-lg">Network tab (DevTools)</h4>
            <p class="text-slate-300">Inspeccionar payloads de red directamente.</p>
          </div>
        </div>
      </div>
      
      <div class="bg-slate-800/50 p-6 rounded-xl">
        <div class="flex items-start gap-4">
          <span class="w-4 h-4 bg-slate-400 rounded-full mt-2 shrink-0"></span>
          <div>
            <h4 class="font-bold text-lg">Entornos staging vs producciÃ³n</h4>
            <p class="text-slate-300">Validar antes de lanzar.</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Mini-juego: QA Tool Selector -->
    <div class="mt-12 max-w-3xl mx-auto">
      <h3 class="text-2xl font-bold text-center mb-6">ğŸ® Tu turno: Â¿QuÃ© herramientas usas?</h3>
      <QAToolSelector client:visible />
    </div>
  </section>

  <!-- ValidaciÃ³n cruzada -->
  <section class="py-12 border-t border-slate-700">
    <h2 class="text-3xl font-bold text-center mb-8">ğŸ”— ValidaciÃ³n cruzada</h2>
    
    <div class="bg-slate-800/50 rounded-xl p-6 max-w-3xl mx-auto mb-8">
      <p class="text-lg">Una validaciÃ³n sÃ³lida no depende de una sola herramienta.</p>
    </div>

    <div class="max-w-3xl mx-auto mb-8">
      <h3 class="font-bold mb-6 text-center">ğŸ” LÃ³gica de QA robusta:</h3>
      
      <div class="space-y-4">
        <div class="flex items-start gap-4 p-4 bg-slate-800/30 rounded-lg">
          <span class="w-8 h-8 bg-emerald-500 rounded-full flex items-center justify-center font-bold shrink-0">1</span>
          <div>
            <h4 class="font-bold">Validar en GTM Preview</h4>
            <p class="text-slate-300 text-sm">Que el evento entra y se activan triggers correctos</p>
          </div>
        </div>
        
        <div class="flex items-start gap-4 p-4 bg-slate-800/30 rounded-lg">
          <span class="w-8 h-8 bg-emerald-500 rounded-full flex items-center justify-center font-bold shrink-0">2</span>
          <div>
            <h4 class="font-bold">Validar en GA4 DebugView</h4>
            <p class="text-slate-300 text-sm">Que el evento llega con los parÃ¡metros esperados</p>
          </div>
        </div>
        
        <div class="flex items-start gap-4 p-4 bg-slate-800/30 rounded-lg">
          <span class="w-8 h-8 bg-emerald-500 rounded-full flex items-center justify-center font-bold shrink-0">3</span>
          <div>
            <h4 class="font-bold">Validar en Network tab u Omnibug</h4>
            <p class="text-slate-300 text-sm">El payload real enviado</p>
          </div>
        </div>
        
        <div class="flex items-start gap-4 p-4 bg-slate-800/30 rounded-lg">
          <span class="w-8 h-8 bg-emerald-500 rounded-full flex items-center justify-center font-bold shrink-0">4</span>
          <div>
            <h4 class="font-bold">Validar en el reporting</h4>
            <p class="text-slate-300 text-sm">Si aparece en los dashboards esperados (retrasado)</p>
          </div>
        </div>
      </div>
    </div>

    <div class="bg-slate-800/50 rounded-xl p-6 max-w-3xl mx-auto">
      <h3 class="font-bold mb-4">ğŸ“Š Ejemplo real:</h3>
      <ul class="space-y-2 text-slate-300">
        <li>âœ… Evento de compra â†’ visto en Preview</li>
        <li>âŒ No llega a GA4 â†’ error en nombre de parÃ¡metro</li>
        <li>ğŸ” Se detecta en Network â†’ parÃ¡metro mal escrito</li>
        <li>âœ… CorrecciÃ³n â†’ validaciÃ³n final</li>
      </ul>
    </div>

    <div class="bg-amber-500/10 border-l-4 border-amber-500 p-6 rounded-r-xl max-w-3xl mx-auto mt-8 text-center">
      <p class="text-lg font-bold">"Si aprendes a seguir el rastro, ningÃºn error se esconde."</p>
    </div>
    
    <!-- Mini-juego: Funnel Detective -->
    <div class="mt-12 max-w-3xl mx-auto">
      <h3 class="text-2xl font-bold text-center mb-6">ğŸ® Tu turno: Encuentra el error en el funnel</h3>
      <FunnelDetective client:visible />
    </div>
  </section>

  <!-- Validar en diferentes entornos -->
  <section class="py-12 border-t border-slate-700">
    <h2 class="text-3xl font-bold text-center mb-8">ğŸŒ Validar en diferentes entornos</h2>
    
    <div class="bg-slate-800/50 rounded-xl p-6 max-w-3xl mx-auto mb-8">
      <p class="text-lg mb-4">No todo se valida igual en dev, staging y producciÃ³n.</p>
      <p class="text-amber-300 font-bold">Un funnel puede funcionar perfecto en staging y romperse en live.</p>
    </div>

    <div class="bg-emerald-500/10 p-6 rounded-xl max-w-2xl mx-auto mb-8">
      <h3 class="font-bold mb-4">ğŸ“‹ Checklist de QA por entorno:</h3>
      <ul class="space-y-2 text-slate-300">
        <li>âœ… Verificar snippet correcto y container ID</li>
        <li>âœ… Asegurar que cookies y consentimientos funcionan igual</li>
        <li>âœ… Revisar si hay bloqueadores (adblock, Safari ITP, etc.)</li>
        <li>âœ… Validar rutas de red y dominios correctos</li>
      </ul>
    </div>

    <div class="bg-red-500/10 border-l-4 border-red-500 p-6 rounded-r-xl max-w-2xl mx-auto mb-12">
      <h3 class="font-bold text-red-400 mb-4">âš ï¸ Casos frecuentes:</h3>
      <ul class="space-y-2 text-slate-300">
        <li>â€¢ Eventos que desaparecen en producciÃ³n</li>
        <li>â€¢ Cambios en DOM que rompen triggers</li>
        <li>â€¢ Versiones antiguas de container activas</li>
      </ul>
    </div>
    
    <!-- Mini-juego: Staging Bug Quiz -->
    <div class="max-w-3xl mx-auto">
      <h3 class="text-2xl font-bold text-center mb-6">ğŸ® Tu turno: Â¿Por quÃ© no funciona en producciÃ³n?</h3>
      <StagingBugQuiz client:visible />
    </div>
  </section>

  <!-- QA + Marketing -->
  <section class="py-12 border-t border-slate-700">
    <h2 class="text-3xl font-bold text-center mb-8">ğŸ’¼ QA + Marketing (Valor estratÃ©gico)</h2>
    
    <div class="bg-emerald-500/10 p-6 rounded-xl max-w-2xl mx-auto mb-8">
      <h3 class="font-bold mb-4">ğŸ’ª Superpoderes del marketer con QA:</h3>
      <ul class="space-y-3 text-slate-300">
        <li class="text-lg">âœ… Saber si tus campaÃ±as miden bien desde el dÃ­a 0</li>
        <li class="text-lg">âœ… Poder lanzar sin depender de desarrollo</li>
        <li class="text-lg">âœ… Entender los lÃ­mites de las plataformas</li>
        <li class="text-lg">âœ… Detectar problemas antes de que cuesten dinero</li>
      </ul>
    </div>

    <div class="bg-amber-500/10 border-l-4 border-amber-500 p-6 rounded-r-xl max-w-3xl mx-auto text-center">
      <p class="text-lg font-bold">"Medir no es solo lanzar.</p>
      <p class="text-lg font-bold text-amber-300">Medir es confirmar que la historia que cuentan los datos... es real."</p>
    </div>
  </section>

  <!-- Resumen Final -->
  <section class="py-12 border-t border-slate-700 text-center">
    <div class="text-6xl mb-6">ğŸ‘ï¸</div>
    <h2 class="text-3xl font-bold mb-6">El ojo que todo lo ve</h2>
    
    <div class="bg-slate-800/50 rounded-xl p-8 max-w-2xl mx-auto mb-8">
      <p class="text-xl mb-6">ğŸ† <strong>Â¡Felicidades!</strong> Has completado el Bloque 3.</p>
      
      <h3 class="font-bold mb-4">ğŸ“š Lo que has aprendido:</h3>
      <ul class="text-left space-y-2 text-slate-300">
        <li>âœ… A usar las herramientas de QA en profundidad</li>
        <li>âœ… A validar datos en mÃºltiples capas y entornos</li>
        <li>âœ… A detectar eventos fantasmas y bugs reales</li>
        <li>âœ… A seguir el rastro de un dato desde GTM hasta reporting</li>
        <li>âœ… A ser autÃ³nomo en la validaciÃ³n sin depender de tech</li>
      </ul>
    </div>

    <p class="text-xl text-slate-300">Ahora no solo hablas GTM...</p>
    <p class="text-xl font-bold text-emerald-400 mb-8">Lo auditas como un pro.</p>
  </section>
</BloqueLayout>
