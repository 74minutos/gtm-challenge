---
import BloqueLayout from '../layouts/BloqueLayout.astro';
---

<BloqueLayout 
  title="Bloque 2: El lenguaje de los eventos" 
  bloque={2}
  prevLink="/bloque-1"
  nextLink="/bloque-3"
>
  <!-- Welcome -->
  <section class="py-12 text-center">
    <div class="text-6xl mb-4">ğŸ§ </div>
    <h1 class="text-4xl font-bold mb-4">El lenguaje secreto de los eventos</h1>
    <span class="inline-block px-4 py-2 bg-emerald-500/20 text-emerald-300 rounded-full text-sm mb-8">
      â±ï¸ Bloque 2 Â· ~30 min
    </span>
    
    <div class="bg-slate-800/50 rounded-xl p-6 max-w-3xl mx-auto text-left mb-8">
      <p class="text-xl mb-4"><strong>Has construido la torre. Ahora toca darle voz.</strong></p>
      <p class="text-slate-300">En este bloque descubrirÃ¡s el idioma secreto de los eventos: cÃ³mo nombrarlos, estructurarlos y hacer que cada uno cuente una historia clara.</p>
    </div>
  </section>

  <!-- Â¿QuÃ© es el dataLayer? -->
  <section class="py-12 border-t border-slate-700">
    <h2 class="text-3xl font-bold text-center mb-8">ğŸ“¦ Â¿QuÃ© es el dataLayer?</h2>
    <span class="block text-center text-sm text-slate-400 mb-8">Concepto clave Â· 3 min</span>
    
    <div class="bg-blue-500/10 border-l-4 border-blue-500 p-6 rounded-r-xl mb-8 max-w-3xl mx-auto">
      <p class="text-lg mb-4"><strong>Antes de hablar de eventos, necesitas entender dÃ³nde "viven" esos eventos.</strong></p>
      <p class="text-slate-300">Imagina que tu web es un restaurante. Cada cosa que pasa (cliente entra, pide carta, hace pedido, paga) es informaciÃ³n valiosa. Pero... Â¿dÃ³nde se apunta todo eso?</p>
    </div>

    <div class="grid md:grid-cols-3 gap-6 max-w-5xl mx-auto mb-8">
      <div class="bg-slate-800/50 p-6 rounded-xl border-l-4 border-red-500">
        <h3 class="text-xl font-bold mb-3">âŒ Sin sistema</h3>
        <p class="text-slate-300 text-sm">Cada camarero tiene su propia libreta. Nadie sabe cuÃ¡ntos clientes pidieron el especial.</p>
        <p class="text-slate-500 text-xs mt-2"><strong>= Web sin dataLayer</strong></p>
      </div>
      <div class="bg-slate-800/50 p-6 rounded-xl border-l-4 border-green-500">
        <h3 class="text-xl font-bold mb-3">âœ… Con sistema</h3>
        <p class="text-slate-300 text-sm">Hay UN libro central donde TODO se apunta. Cualquiera puede consultarlo.</p>
        <p class="text-slate-500 text-xs mt-2"><strong>= Web con dataLayer</strong></p>
      </div>
      <div class="bg-slate-800/50 p-6 rounded-xl border-l-4 border-blue-500">
        <h3 class="text-xl font-bold mb-3">ğŸ¯ El dataLayer</h3>
        <p class="text-slate-300 text-sm">Es ese "libro central". Un array de JavaScript donde la web escribe todo lo que pasa.</p>
        <p class="text-slate-500 text-xs mt-2"><strong>= La fuente de verdad</strong></p>
      </div>
    </div>

    <!-- CÃ³digo tÃ©cnico -->
    <div class="bg-slate-900 rounded-xl p-6 max-w-3xl mx-auto">
      <h4 class="text-blue-400 font-bold mb-4">ğŸ”§ TÃ©cnicamente (muy simple)</h4>
      <p class="text-slate-300 mb-4">El dataLayer es una variable que ya existe en tu web cuando instalas GTM:</p>
      <pre class="bg-black p-4 rounded-lg text-green-400 font-mono text-sm overflow-x-auto mb-4">dataLayer = []   // â† Un array vacÃ­o esperando informaciÃ³n</pre>
      <p class="text-slate-300 mb-4">Cuando algo pasa, la web "empuja" (push) informaciÃ³n a ese array:</p>
      <pre class="bg-black p-4 rounded-lg text-green-400 font-mono text-sm overflow-x-auto">dataLayer.push({'{'} event: 'algo_pasÃ³' {'}'})   // â† "Oye GTM, pasÃ³ algo!"</pre>
    </div>
  </section>

  <!-- AnatomÃ­a de un evento -->
  <section class="py-12 border-t border-slate-700">
    <h2 class="text-3xl font-bold text-center mb-8">ğŸ“Š AnatomÃ­a de un evento en GTM</h2>
    
    <div class="bg-black rounded-xl p-6 max-w-3xl mx-auto mb-8 font-mono">
      <p class="text-slate-500 mb-2">// Estructura base de un evento en el dataLayer:</p>
      <pre class="text-green-400">dataLayer.push({'{'}
  event: 'nombre_del_evento',
  key1: 'valor1',
  key2: 'valor2'
{'}'})</pre>
    </div>

    <div class="grid md:grid-cols-3 gap-6 max-w-4xl mx-auto mb-8">
      <div class="bg-slate-800/50 p-6 rounded-xl text-center">
        <div class="text-4xl mb-4">ğŸ¯</div>
        <h4 class="font-bold mb-2">event</h4>
        <p class="text-slate-300 text-sm">El identificador que GTM escucha. Ej: 'add_to_cart', 'purchase'</p>
      </div>
      <div class="bg-slate-800/50 p-6 rounded-xl text-center">
        <div class="text-4xl mb-4">ğŸ”‘</div>
        <h4 class="font-bold mb-2">keys (variables)</h4>
        <p class="text-slate-300 text-sm">Pares clave-valor con informaciÃ³n. Ej: product_id, price</p>
      </div>
      <div class="bg-slate-800/50 p-6 rounded-xl text-center">
        <div class="text-4xl mb-4">âš¡</div>
        <h4 class="font-bold mb-2">Flujo</h4>
        <p class="text-slate-300 text-sm">GTM escucha â†’ evalÃºa triggers â†’ ejecuta tags</p>
      </div>
    </div>

    <!-- Casos reales -->
    <h3 class="text-xl font-bold text-center mb-6">ğŸ¯ Casos reales: Lo que se pierde por eventos mal nombrados</h3>
    
    <div class="grid md:grid-cols-3 gap-6 max-w-5xl mx-auto">
      <div class="bg-red-500/10 p-6 rounded-xl border-l-4 border-red-500">
        <h4 class="font-bold text-red-400 mb-3">âŒ E-commerce sin eventos claros</h4>
        <p class="text-sm text-slate-300 mb-2"><strong>Problema:</strong> Todos los clicks van a un evento genÃ©rico "click".</p>
        <p class="text-xs text-slate-400"><strong>Consecuencia:</strong> Marketing no puede optimizar. Pierden 30% de posible revenue.</p>
      </div>
      <div class="bg-blue-500/10 p-6 rounded-xl border-l-4 border-blue-500">
        <h4 class="font-bold text-blue-400 mb-3">âŒ SaaS sin feature tracking</h4>
        <p class="text-sm text-slate-300 mb-2"><strong>Problema:</strong> No trackean quÃ© features usan los clientes.</p>
        <p class="text-xs text-slate-400"><strong>Consecuencia:</strong> Gastan â‚¬500k/aÃ±o en feature que nadie usa.</p>
      </div>
      <div class="bg-green-500/10 p-6 rounded-xl border-l-4 border-green-500">
        <h4 class="font-bold text-green-400 mb-3">âœ… E-commerce con eventos precisos</h4>
        <p class="text-sm text-slate-300 mb-2"><strong>Estructura:</strong> Eventos especÃ­ficos con variables.</p>
        <p class="text-xs text-slate-400"><strong>Resultado:</strong> +25% conversiÃ³n. â‚¬2M de revenue extra.</p>
      </div>
    </div>
  </section>

  <!-- Tipos de Triggers -->
  <section class="py-12 border-t border-slate-700">
    <h2 class="text-3xl font-bold text-center mb-8">ğŸ¯ Tipos de triggers (lÃ³gica avanzada)</h2>
    
    <div class="bg-slate-800/50 rounded-xl p-6 max-w-3xl mx-auto mb-8">
      <p class="text-lg mb-4"><strong>Un trigger es la condiciÃ³n lÃ³gica</strong> que hace que una etiqueta se dispare.</p>
      <p class="text-slate-300">No basta con escuchar el evento: hay que saber <strong>cuÃ¡ndo y bajo quÃ© condiciones.</strong></p>
    </div>

    <div class="space-y-4 max-w-2xl mx-auto mb-8">
      <div class="flex items-center gap-4 p-4 bg-slate-800/30 rounded-lg">
        <span class="w-4 h-4 bg-green-500 rounded-full"></span>
        <span><strong>Custom Event Trigger:</strong> escucha dataLayer.push</span>
      </div>
      <div class="flex items-center gap-4 p-4 bg-slate-800/30 rounded-lg">
        <span class="w-4 h-4 bg-yellow-500 rounded-full"></span>
        <span><strong>Click Trigger:</strong> escucha interacciÃ³n directa en elementos</span>
      </div>
      <div class="flex items-center gap-4 p-4 bg-slate-800/30 rounded-lg">
        <span class="w-4 h-4 bg-blue-500 rounded-full"></span>
        <span><strong>Pageview Trigger:</strong> escucha cargas de pÃ¡gina</span>
      </div>
      <div class="flex items-center gap-4 p-4 bg-slate-800/30 rounded-lg">
        <span class="w-4 h-4 bg-orange-500 rounded-full"></span>
        <span><strong>Otros:</strong> Form Submission, Timer, History Change...</span>
      </div>
    </div>

    <div class="bg-emerald-500/10 p-6 rounded-xl max-w-2xl mx-auto">
      <h4 class="font-bold mb-4">ğŸ“Œ Ejemplo de condicional:</h4>
      <ul class="space-y-2 text-slate-300">
        <li>âœ… <strong>Evento:</strong> add_to_cart</li>
        <li>âœ… <strong>CondiciÃ³n:</strong> price > 0</li>
        <li>âœ… <strong>AcciÃ³n:</strong> disparar GA4 event</li>
      </ul>
    </div>
  </section>

  <!-- Variables -->
  <section class="py-12 border-t border-slate-700">
    <h2 class="text-3xl font-bold text-center mb-8">ğŸ“¦ Variables (profundidad estratÃ©gica)</h2>
    
    <div class="bg-slate-800/50 rounded-xl p-6 max-w-3xl mx-auto mb-8">
      <p class="text-lg"><strong>Las variables son la memoria de GTM.</strong> Es donde guarda informaciÃ³n temporal que luego se usa en etiquetas o triggers.</p>
    </div>

    <div class="grid md:grid-cols-3 gap-6 max-w-4xl mx-auto mb-8">
      <div class="bg-slate-800/50 p-6 rounded-xl text-center">
        <div class="text-4xl mb-4">ğŸ”§</div>
        <h4 class="font-bold mb-2">Built-in</h4>
        <p class="text-slate-300 text-sm">Click URL, Page URL, Referrer...</p>
      </div>
      <div class="bg-slate-800/50 p-6 rounded-xl text-center">
        <div class="text-4xl mb-4">ğŸ“Š</div>
        <h4 class="font-bold mb-2">Data Layer</h4>
        <p class="text-slate-300 text-sm">Variables extraÃ­das del dataLayer</p>
      </div>
      <div class="bg-slate-800/50 p-6 rounded-xl text-center">
        <div class="text-4xl mb-4">âš™ï¸</div>
        <h4 class="font-bold mb-2">Personalizadas</h4>
        <p class="text-slate-300 text-sm">JavaScript, Lookup Tables, Regex...</p>
      </div>
    </div>

    <div class="bg-black rounded-xl p-6 max-w-3xl mx-auto font-mono">
      <p class="text-slate-500 mb-2">// Ejemplo:</p>
      <pre class="text-green-400">dataLayer.push({'{'}
  event: 'purchase',
  transaction_id: '12345',
  revenue: 100
{'}'})

// Variable transaction_id extraÃ­da â†’ GA4 event
// Variable revenue â†’ envÃ­o a Ads</pre>
    </div>
  </section>

  <!-- Tags -->
  <section class="py-12 border-t border-slate-700">
    <h2 class="text-3xl font-bold text-center mb-8">ğŸ·ï¸ Tags (acciÃ³n y responsabilidad)</h2>
    
    <div class="bg-slate-800/50 rounded-xl p-6 max-w-3xl mx-auto mb-8">
      <p class="text-lg"><strong>Una Tag es la acciÃ³n final</strong> que ejecuta GTM cuando un trigger se cumple.</p>
    </div>

    <div class="space-y-4 max-w-2xl mx-auto mb-8">
      <div class="flex items-center gap-4 p-4 bg-slate-800/30 rounded-lg">
        <span class="text-2xl">ğŸ“¤</span>
        <span>Enviar datos a plataformas (GA4, Meta, TikTok...)</span>
      </div>
      <div class="flex items-center gap-4 p-4 bg-slate-800/30 rounded-lg">
        <span class="text-2xl">ğŸ’»</span>
        <span>Ejecutar cÃ³digo custom</span>
      </div>
      <div class="flex items-center gap-4 p-4 bg-slate-800/30 rounded-lg">
        <span class="text-2xl">ğŸ“œ</span>
        <span>Cargar scripts de terceros</span>
      </div>
    </div>

    <div class="bg-amber-500/10 border-2 border-amber-500 p-6 rounded-xl max-w-3xl mx-auto text-center">
      <p class="text-lg"><strong>"Si triggers son los oÃ­dos, y variables la memoria...</strong></p>
      <p class="text-lg"><strong>Las tags son la voz."</strong></p>
    </div>
  </section>

  <!-- Debugging -->
  <section class="py-12 border-t border-slate-700">
    <h2 class="text-3xl font-bold text-center mb-8">ğŸ” Debugging y QA</h2>
    
    <div class="bg-emerald-500/10 p-6 rounded-xl max-w-3xl mx-auto mb-8">
      <h3 class="font-bold mb-4">ğŸ“Œ QuÃ© mirar en el Debugger:</h3>
      <div class="grid grid-cols-2 md:grid-cols-5 gap-4 text-center">
        <div class="p-3 bg-slate-800/50 rounded-lg">
          <span class="text-2xl">ğŸ‘‚</span>
          <p class="text-xs mt-2">Evento escuchado</p>
        </div>
        <div class="p-3 bg-slate-800/50 rounded-lg">
          <span class="text-2xl">ğŸ¯</span>
          <p class="text-xs mt-2">Triggers activados</p>
        </div>
        <div class="p-3 bg-slate-800/50 rounded-lg">
          <span class="text-2xl">ğŸ“¦</span>
          <p class="text-xs mt-2">Variables leÃ­das</p>
        </div>
        <div class="p-3 bg-slate-800/50 rounded-lg">
          <span class="text-2xl">ğŸ·ï¸</span>
          <p class="text-xs mt-2">Etiquetas ejecutadas</p>
        </div>
        <div class="p-3 bg-slate-800/50 rounded-lg">
          <span class="text-2xl">ğŸ”¢</span>
          <p class="text-xs mt-2">Orden de disparo</p>
        </div>
      </div>
    </div>

    <div class="bg-slate-800/50 rounded-xl p-6 max-w-3xl mx-auto">
      <h3 class="font-bold mb-4">ğŸ§  Errores comunes a detectar:</h3>
      <div class="space-y-3">
        <div class="flex items-center gap-3">
          <span class="text-red-400">âŒ</span>
          <span><strong>Typos:</strong> Nombres mal escritos</span>
        </div>
        <div class="flex items-center gap-3">
          <span class="text-red-400">ğŸš«</span>
          <span><strong>Triggers mal definidos:</strong> Condiciones incorrectas</span>
        </div>
        <div class="flex items-center gap-3">
          <span class="text-amber-400">âš ï¸</span>
          <span><strong>Eventos mal nombrados:</strong> Inconsistencia</span>
        </div>
        <div class="flex items-center gap-3">
          <span class="text-amber-400">ğŸ”§</span>
          <span><strong>Variables undefined:</strong> No capturadas correctamente</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Naming & Estrategia -->
  <section class="py-12 border-t border-slate-700">
    <h2 class="text-3xl font-bold text-center mb-8">ğŸ“ Estrategia y naming</h2>
    
    <div class="grid md:grid-cols-3 gap-6 max-w-4xl mx-auto mb-8">
      <div class="bg-slate-800/50 p-6 rounded-xl text-center">
        <div class="text-4xl mb-4">âœ…</div>
        <h4 class="font-bold mb-2">Consistencia</h4>
        <p class="text-slate-300 text-sm">Menos errores</p>
      </div>
      <div class="bg-slate-800/50 p-6 rounded-xl text-center">
        <div class="text-4xl mb-4">ğŸ’¡</div>
        <h4 class="font-bold mb-2">Claridad</h4>
        <p class="text-slate-300 text-sm">Mejor colaboraciÃ³n</p>
      </div>
      <div class="bg-slate-800/50 p-6 rounded-xl text-center">
        <div class="text-4xl mb-4">ğŸ“ˆ</div>
        <h4 class="font-bold mb-2">Escalabilidad</h4>
        <p class="text-slate-300 text-sm">Proyectos mÃ¡s robustos</p>
      </div>
    </div>

    <div class="bg-emerald-500/10 p-6 rounded-xl max-w-3xl mx-auto">
      <h3 class="font-bold mb-4">ğŸ“Œ Buenas prÃ¡cticas:</h3>
      <div class="space-y-3">
        <div class="flex items-center gap-3">
          <span>ğŸ”¤</span>
          <span><strong>snake_case</strong> o <strong>camelCase</strong> consistente</span>
        </div>
        <div class="flex items-center gap-3">
          <span>ğŸ·ï¸</span>
          <span>Prefijos lÃ³gicos (<code class="bg-slate-700 px-2 py-1 rounded">add_to_cart</code>, <code class="bg-slate-700 px-2 py-1 rounded">begin_checkout</code>)</span>
        </div>
        <div class="flex items-center gap-3">
          <span>ğŸ”„</span>
          <span>Eventos comunes entre plataformas</span>
        </div>
        <div class="flex items-center gap-3">
          <span>ğŸ“š</span>
          <span>DocumentaciÃ³n clara del schema</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Resumen Final -->
  <section class="py-12 border-t border-slate-700 text-center">
    <div class="text-6xl mb-6">ğŸ‰</div>
    <h2 class="text-3xl font-bold mb-6">Ya Hablas GTM</h2>
    
    <div class="bg-slate-800/50 rounded-xl p-8 max-w-2xl mx-auto mb-8">
      <p class="text-xl mb-6">ğŸ† <strong>Â¡Felicidades!</strong> Has completado el Bloque 2.</p>
      
      <h3 class="font-bold mb-4">ğŸ“š Lo que has aprendido:</h3>
      <ul class="text-left space-y-2 text-slate-300">
        <li>âœ… La anatomÃ­a de un evento</li>
        <li>âœ… CÃ³mo configurar triggers y variables con precisiÃ³n</li>
        <li>âœ… CÃ³mo lanzar y verificar tags</li>
        <li>âœ… CÃ³mo nombrar bien para que todo escale</li>
        <li>âœ… Debugging avanzado con GTM Debugger</li>
      </ul>
    </div>

    <p class="text-xl text-slate-300">Hoy, ya no solo escuchas.</p>
    <p class="text-xl font-bold text-emerald-400 mb-8">Hablas el idioma de GTM con fluidez.</p>
  </section>
</BloqueLayout>
