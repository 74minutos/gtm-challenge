---
import BloqueLayout from '../layouts/BloqueLayout.astro';
---

<BloqueLayout 
  title="Demo Live: GTM en AcciÃ³n" 
  bloqueId="demo-live"
>
  <!-- Welcome -->
  <section class="py-12 text-center">
    <div class="text-6xl mb-4">ğŸ¬</div>
    <h1 class="text-4xl font-bold mb-4">Demo Live: GTM en AcciÃ³n</h1>
    <span class="inline-block px-4 py-2 bg-pink-500/20 text-pink-300 rounded-full text-sm mb-8">
      ğŸ‘¨â€ğŸ« SecciÃ³n guiada por el profesor
    </span>
    
    <div class="bg-slate-800/50 rounded-xl p-6 max-w-3xl mx-auto text-left mb-8">
      <p class="text-xl mb-4"><strong>Ahora toca ver GTM en acciÃ³n real.</strong></p>
      <p class="text-slate-300">El profesor te guiarÃ¡ por las 3 implementaciones mÃ¡s comunes en marketing digital.</p>
    </div>

    <div class="grid md:grid-cols-3 gap-6 max-w-5xl mx-auto">
      <div class="bg-slate-800/50 p-6 rounded-xl border-l-4 border-[#1877f2]">
        <h3 class="text-xl font-bold mb-3">ğŸ“˜ Meta Pixel (Facebook)</h3>
        <p class="text-slate-300 text-sm mb-2">PageView, ViewContent, AddToCart, Purchase, Lead y sus variantes.</p>
        <p class="text-slate-500 text-xs">El pixel mÃ¡s usado en paid social.</p>
      </div>
      <div class="bg-slate-800/50 p-6 rounded-xl border-l-4 border-orange-500">
        <h3 class="text-xl font-bold mb-3">ğŸ“Š GA4: Lead & E-commerce</h3>
        <p class="text-slate-300 text-sm mb-2">Eventos estÃ¡ndar para captaciÃ³n de leads y tiendas online.</p>
        <p class="text-slate-500 text-xs">La base de toda mediciÃ³n moderna.</p>
      </div>
      <div class="bg-slate-800/50 p-6 rounded-xl border-l-4 border-green-500">
        <h3 class="text-xl font-bold mb-3">ğŸ”’ Meta CAPI (Server-side)</h3>
        <p class="text-slate-300 text-sm mb-2">EnvÃ­o server-to-server para mejor atribuciÃ³n y privacidad.</p>
        <p class="text-slate-500 text-xs">El futuro del tracking post-cookies.</p>
      </div>
    </div>
  </section>

  <!-- Demo 1: Meta Pixel -->
  <section class="py-12 border-t border-slate-700">
    <h2 class="text-3xl font-bold text-center mb-2">ğŸ“˜ Demo 1: Meta Pixel (Facebook)</h2>
    <p class="text-center text-slate-400 mb-8">ğŸ‘¨â€ğŸ« El profesor muestra en GTM real</p>

    <div class="bg-blue-500/10 border-l-4 border-blue-500 p-6 rounded-r-xl max-w-3xl mx-auto mb-8">
      <h4 class="font-bold mb-3">ğŸ’¡ Â¿Por quÃ© Meta Pixel?</h4>
      <p class="text-slate-300">Es el tag mÃ¡s comÃºn en marketing. Si no lo configuras bien, tus campaÃ±as de Facebook/Instagram no optimizan correctamente y pierdes dinero en ads.</p>
    </div>

    <div class="bg-[#1877f2]/10 border-2 border-[#1877f2] p-6 rounded-xl max-w-4xl mx-auto mb-8">
      <h3 class="text-[#1877f2] font-bold mb-6">ğŸ¯ Lo que el profesor mostrarÃ¡:</h3>
      
      <div class="space-y-4">
        <div class="flex items-start gap-4">
          <span class="w-8 h-8 bg-[#1877f2] rounded-full flex items-center justify-center font-bold shrink-0 text-sm">1</span>
          <div>
            <h4 class="font-bold">Crear el tag base de Meta Pixel</h4>
            <p class="text-slate-300 text-sm">Configurar el Pixel ID y el tag PageView que dispara en todas las pÃ¡ginas.</p>
          </div>
        </div>
        
        <div class="flex items-start gap-4">
          <span class="w-8 h-8 bg-[#1877f2] rounded-full flex items-center justify-center font-bold shrink-0 text-sm">2</span>
          <div>
            <h4 class="font-bold">Eventos estÃ¡ndar de e-commerce</h4>
            <p class="text-slate-300 text-sm"><code class="bg-slate-700 px-1 rounded">ViewContent</code>, <code class="bg-slate-700 px-1 rounded">AddToCart</code>, <code class="bg-slate-700 px-1 rounded">InitiateCheckout</code>, <code class="bg-slate-700 px-1 rounded">Purchase</code>.</p>
          </div>
        </div>
        
        <div class="flex items-start gap-4">
          <span class="w-8 h-8 bg-[#1877f2] rounded-full flex items-center justify-center font-bold shrink-0 text-sm">3</span>
          <div>
            <h4 class="font-bold">Eventos de lead generation</h4>
            <p class="text-slate-300 text-sm"><code class="bg-slate-700 px-1 rounded">Lead</code>, <code class="bg-slate-700 px-1 rounded">CompleteRegistration</code>, <code class="bg-slate-700 px-1 rounded">Contact</code>.</p>
          </div>
        </div>
        
        <div class="flex items-start gap-4">
          <span class="w-8 h-8 bg-[#1877f2] rounded-full flex items-center justify-center font-bold shrink-0 text-sm">4</span>
          <div>
            <h4 class="font-bold">ParÃ¡metros dinÃ¡micos</h4>
            <p class="text-slate-300 text-sm">Pasar <code class="bg-slate-700 px-1 rounded">value</code>, <code class="bg-slate-700 px-1 rounded">currency</code>, <code class="bg-slate-700 px-1 rounded">content_ids</code> desde el dataLayer.</p>
          </div>
        </div>
        
        <div class="flex items-start gap-4">
          <span class="w-8 h-8 bg-[#1877f2] rounded-full flex items-center justify-center font-bold shrink-0 text-sm">5</span>
          <div>
            <h4 class="font-bold">Verificar con Facebook Pixel Helper</h4>
            <p class="text-slate-300 text-sm">Usar la extensiÃ³n de Chrome para validar que todo funciona.</p>
            <a href="https://chrome.google.com/webstore/detail/facebook-pixel-helper/fdgfkebogiimcoedlicjlajpkdmockpc" target="_blank" class="text-blue-400 text-sm hover:underline">â†’ Instalar extensiÃ³n</a>
          </div>
        </div>
      </div>
    </div>

    <div class="bg-red-500/10 border-l-4 border-red-500 p-6 rounded-r-xl max-w-3xl mx-auto">
      <h4 class="font-bold text-pink-400 mb-3">âš ï¸ Errores comunes que verÃ¡s en auditorÃ­as:</h4>
      <ul class="space-y-2 text-slate-300">
        <li>âŒ Pixel duplicado (dispara 2 veces = datos inflados)</li>
        <li>âŒ Purchase sin <code class="bg-slate-700 px-1 rounded">value</code> (no puedes calcular ROAS)</li>
        <li>âŒ Eventos en pÃ¡gina incorrecta (AddToCart en home)</li>
        <li>âŒ No usar <code class="bg-slate-700 px-1 rounded">content_ids</code> (remarketing dinÃ¡mico no funciona)</li>
      </ul>
    </div>
  </section>

  <!-- Demo 2: GA4 -->
  <section class="py-12 border-t border-slate-700">
    <h2 class="text-3xl font-bold text-center mb-2">ğŸ“Š Demo 2: GA4 para Lead Gen y E-commerce</h2>
    <p class="text-center text-slate-400 mb-8">ğŸ‘¨â€ğŸ« El profesor muestra en GTM real</p>

    <div class="bg-orange-500/10 border-l-4 border-orange-500 p-6 rounded-r-xl max-w-3xl mx-auto mb-8">
      <h4 class="font-bold mb-3">ğŸ’¡ Â¿Por quÃ© GA4?</h4>
      <p class="text-slate-300">Es el estÃ¡ndar de mediciÃ³n de Google. Sin GA4 bien configurado, no tienes datos fiables para tomar decisiones ni para alimentar Google Ads.</p>
    </div>

    <div class="grid md:grid-cols-2 gap-6 max-w-4xl mx-auto mb-8">
      <!-- Lead Generation -->
      <div class="bg-green-500/10 border-2 border-green-500 p-6 rounded-xl">
        <h3 class="text-green-400 font-bold mb-4">ğŸ“ Lead Generation</h3>
        <p class="text-slate-400 text-sm mb-4">Para webs de servicios, B2B, inmobiliarias, etc.</p>
        
        <h4 class="font-bold mb-2 text-sm">Eventos clave:</h4>
        <ul class="text-sm text-slate-300 space-y-1 mb-4">
          <li><code class="bg-slate-700 px-1 rounded">generate_lead</code> - Formulario enviado</li>
          <li><code class="bg-slate-700 px-1 rounded">sign_up</code> - Registro completado</li>
          <li><code class="bg-slate-700 px-1 rounded">contact</code> - Click en telÃ©fono/email</li>
          <li><code class="bg-slate-700 px-1 rounded">form_start</code> - EmpezÃ³ a rellenar</li>
          <li><code class="bg-slate-700 px-1 rounded">file_download</code> - DescargÃ³ PDF</li>
        </ul>
        
        <h4 class="font-bold mb-2 text-sm">ParÃ¡metros importantes:</h4>
        <ul class="text-sm text-slate-300 space-y-1">
          <li><code class="bg-slate-700 px-1 rounded">form_id</code> - Identificar quÃ© formulario</li>
          <li><code class="bg-slate-700 px-1 rounded">form_name</code> - Nombre legible</li>
          <li><code class="bg-slate-700 px-1 rounded">value</code> - Valor estimado del lead</li>
        </ul>
      </div>

      <!-- E-commerce -->
      <div class="bg-orange-500/10 border-2 border-orange-500 p-6 rounded-xl">
        <h3 class="text-orange-400 font-bold mb-4">ğŸ›’ E-commerce</h3>
        <p class="text-slate-400 text-sm mb-4">Para tiendas online, marketplaces, etc.</p>
        
        <h4 class="font-bold mb-2 text-sm">Eventos del funnel:</h4>
        <ul class="text-sm text-slate-300 space-y-1 mb-4">
          <li><code class="bg-slate-700 px-1 rounded">view_item</code> - Vio un producto</li>
          <li><code class="bg-slate-700 px-1 rounded">add_to_cart</code> - AÃ±adiÃ³ al carrito</li>
          <li><code class="bg-slate-700 px-1 rounded">begin_checkout</code> - IniciÃ³ checkout</li>
          <li><code class="bg-slate-700 px-1 rounded">add_payment_info</code> - AÃ±adiÃ³ pago</li>
          <li><code class="bg-slate-700 px-1 rounded">purchase</code> - Compra completada</li>
        </ul>
        
        <h4 class="font-bold mb-2 text-sm">ParÃ¡metros obligatorios:</h4>
        <ul class="text-sm text-slate-300 space-y-1">
          <li><code class="bg-slate-700 px-1 rounded">items[]</code> - Array de productos</li>
          <li><code class="bg-slate-700 px-1 rounded">value</code> - Valor total</li>
          <li><code class="bg-slate-700 px-1 rounded">currency</code> - EUR, USD, etc.</li>
          <li><code class="bg-slate-700 px-1 rounded">transaction_id</code> - ID Ãºnico (solo purchase)</li>
        </ul>
      </div>
    </div>

    <div class="bg-blue-500/10 border-2 border-blue-500 p-6 rounded-xl max-w-3xl mx-auto">
      <h3 class="text-blue-400 font-bold mb-4">ğŸ¯ Lo que el profesor mostrarÃ¡:</h3>
      <ol class="space-y-2 text-slate-300">
        <li>1. Crear tag GA4 Configuration con el Measurement ID</li>
        <li>2. Crear tag GA4 Event para <code class="bg-slate-700 px-1 rounded">generate_lead</code></li>
        <li>3. Configurar el trigger (Form Submission)</li>
        <li>4. Pasar parÃ¡metros desde variables del dataLayer</li>
        <li>5. Verificar en <a href="https://support.google.com/analytics/answer/7201382" target="_blank" class="text-blue-400 hover:underline">GA4 DebugView</a> que el evento llega</li>
        <li>6. Marcar el evento como conversiÃ³n en GA4</li>
      </ol>
    </div>
  </section>

  <!-- Demo 3: Meta CAPI -->
  <section class="py-12 border-t border-slate-700">
    <h2 class="text-3xl font-bold text-center mb-2">ğŸ”’ Demo 3: Meta CAPI (Server-side)</h2>
    <p class="text-center text-slate-400 mb-8">ğŸ‘¨â€ğŸ« El profesor muestra en GTM real</p>

    <div class="bg-purple-500/10 border-l-4 border-purple-500 p-6 rounded-r-xl max-w-3xl mx-auto mb-8">
      <h4 class="font-bold mb-3">ğŸ”® Â¿Por quÃ© CAPI (Conversions API)?</h4>
      <p class="text-slate-300 mb-4">Los navegadores bloquean cada vez mÃ¡s el tracking client-side (cookies, ad-blockers, ITP de Safari). CAPI envÃ­a datos directamente desde tu servidor a Meta, sin pasar por el navegador.</p>
      <p class="text-emerald-400 font-bold">Resultado: Mejor atribuciÃ³n, mÃ¡s conversiones reportadas, mejor optimizaciÃ³n de campaÃ±as.</p>
    </div>

    <div class="grid md:grid-cols-2 gap-6 max-w-4xl mx-auto mb-8">
      <div class="bg-red-500/10 p-6 rounded-xl border-l-4 border-red-500">
        <h4 class="font-bold text-red-400 mb-3">âŒ Solo Pixel (Client-side)</h4>
        <ul class="text-sm text-slate-300 space-y-1">
          <li>â€¢ Ad-blockers lo bloquean (~30% usuarios)</li>
          <li>â€¢ Safari ITP limita cookies a 7 dÃ­as</li>
          <li>â€¢ iOS 14.5+ pide permiso (50% dice no)</li>
          <li>â€¢ Pierdes ~40% de las conversiones</li>
        </ul>
      </div>
      <div class="bg-green-500/10 p-6 rounded-xl border-l-4 border-green-500">
        <h4 class="font-bold text-green-400 mb-3">âœ… Pixel + CAPI (HÃ­brido)</h4>
        <ul class="text-sm text-slate-300 space-y-1">
          <li>â€¢ EnvÃ­o redundante (si uno falla, el otro llega)</li>
          <li>â€¢ Meta deduplica automÃ¡ticamente</li>
          <li>â€¢ Recuperas conversiones perdidas</li>
          <li>â€¢ Mejor Event Match Quality (EMQ)</li>
        </ul>
      </div>
    </div>

    <div class="bg-green-500/10 border-2 border-green-500 p-6 rounded-xl max-w-4xl mx-auto mb-8">
      <h3 class="text-green-400 font-bold mb-6">ğŸ¯ Lo que el profesor mostrarÃ¡:</h3>
      
      <div class="space-y-4">
        <div class="flex items-start gap-4">
          <span class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center font-bold shrink-0 text-sm text-black">1</span>
          <div>
            <h4 class="font-bold">Arquitectura: Cliente + Servidor</h4>
            <p class="text-slate-300 text-sm">Web â†’ GTM Client â†’ GTM Server â†’ Meta CAPI</p>
          </div>
        </div>
        
        <div class="flex items-start gap-4">
          <span class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center font-bold shrink-0 text-sm text-black">2</span>
          <div>
            <h4 class="font-bold">Configurar GTM Server-side container</h4>
            <p class="text-slate-300 text-sm">Crear contenedor en <a href="https://cloud.google.com/run" target="_blank" class="text-blue-400 hover:underline">Google Cloud</a> o <a href="https://stape.io" target="_blank" class="text-blue-400 hover:underline">Stape.io</a>.</p>
          </div>
        </div>
        
        <div class="flex items-start gap-4">
          <span class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center font-bold shrink-0 text-sm text-black">3</span>
          <div>
            <h4 class="font-bold">Enviar eventos desde GTM Web al Server</h4>
            <p class="text-slate-300 text-sm">Usar GA4 como "transport" o el cliente de Meta.</p>
          </div>
        </div>
        
        <div class="flex items-start gap-4">
          <span class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center font-bold shrink-0 text-sm text-black">4</span>
          <div>
            <h4 class="font-bold">Configurar el tag de Meta CAPI en Server</h4>
            <p class="text-slate-300 text-sm">Pixel ID, Access Token, mapear eventos y parÃ¡metros.</p>
          </div>
        </div>
        
        <div class="flex items-start gap-4">
          <span class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center font-bold shrink-0 text-sm text-black">5</span>
          <div>
            <h4 class="font-bold">DeduplicaciÃ³n con event_id</h4>
            <p class="text-slate-300 text-sm">Mismo <code class="bg-slate-700 px-1 rounded">event_id</code> en Pixel y CAPI = Meta sabe que es el mismo evento.</p>
          </div>
        </div>
        
        <div class="flex items-start gap-4">
          <span class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center font-bold shrink-0 text-sm text-black">6</span>
          <div>
            <h4 class="font-bold">Verificar en Meta Events Manager</h4>
            <p class="text-slate-300 text-sm">Ver Event Match Quality, deduplicaciÃ³n y eventos recibidos.</p>
            <a href="https://business.facebook.com/events_manager" target="_blank" class="text-blue-400 text-sm hover:underline">â†’ Abrir Events Manager</a>
          </div>
        </div>
      </div>
    </div>

    <div class="bg-slate-800/50 rounded-xl p-6 max-w-3xl mx-auto">
      <h4 class="font-bold mb-4">ğŸ“Š MÃ©tricas clave en Meta Events Manager:</h4>
      <ul class="space-y-2 text-slate-300">
        <li><strong>Event Match Quality (EMQ):</strong> Objetivo > 6.0 (de 10)</li>
        <li><strong>Deduplication:</strong> Debe mostrar "Deduplicated" en eventos</li>
        <li><strong>Browser vs Server:</strong> Ver ambos canales enviando</li>
      </ul>
    </div>
  </section>

  <!-- Resumen -->
  <section class="py-12 border-t border-slate-700 text-center">
    <div class="text-6xl mb-6">ğŸ¬</div>
    <h2 class="text-3xl font-bold mb-6">Demos Completadas</h2>
    
    <div class="bg-slate-800/50 rounded-xl p-8 max-w-2xl mx-auto mb-8">
      <p class="text-xl mb-6">Has visto las 3 implementaciones mÃ¡s importantes en marketing digital.</p>
      
      <div class="grid grid-cols-3 gap-4 text-center">
        <div>
          <span class="text-3xl">ğŸ“˜</span>
          <p class="text-sm mt-2">Meta Pixel</p>
        </div>
        <div>
          <span class="text-3xl">ğŸ“Š</span>
          <p class="text-sm mt-2">GA4</p>
        </div>
        <div>
          <span class="text-3xl">ğŸ”’</span>
          <p class="text-sm mt-2">Meta CAPI</p>
        </div>
      </div>
    </div>

    <p class="text-xl text-slate-300">Ahora toca aplicarlo.</p>
    <p class="text-xl font-bold text-emerald-400">Siguiente: Arquitectura de Funnels</p>
  </section>
</BloqueLayout>
